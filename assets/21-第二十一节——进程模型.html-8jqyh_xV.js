import{_ as n,c as s,o as a,a as p}from"./app-Cuj6z6E9.js";const t={},e=p(`<h2 id="一、概念" tabindex="-1"><a class="header-anchor" href="#一、概念"><span>一、概念</span></a></h2><p>HarmonyOS的进程模型：</p><ul><li>应用中（同一包名）的所有UIAbility运行在同一个独立进程中。</li><li>WebView拥有独立的渲染进程。</li></ul><p>基于HarmonyOS的进程模型，系统提供了<a href="https://developer.harmonyos.com/cn/docs/documentation/doc-guides-V3/common-event-overview-0000001427744568-V3" target="_blank" rel="noopener noreferrer">公共事件机制</a>用于一对多的通信场景，公共事件发布者可能存在多个订阅者同时接收事件。 二、公共事件 HarmonyOS的公共事件服务（CES）为应用程序提供了一种有效的机制，以订阅、发布和退订公共事件。这种机制有助于实现应用程序间的通信和协作。公共事件服务在系统层面上可以分为系统公共事件和自定义公共事件。</p><p>系统公共事件：这些是CES内部定义的，只有系统应用和服务才能发布。例如，HAP（HarmonyOS应用包）的安装、更新和卸载等都是由系统公共事件来处理的。目前支持的系统公共事件可以在系统公共事件列表中找到。 自定义公共事件：应用程序可以自定义一些公共事件，以实现跨进程的事件通信。这为应用程序间的协作提供了更多的可能性。 从发送方式来看，公共事件可以分为无序公共事件、有序公共事件和粘性公共事件。</p><p>无序公共事件：当CES转发公共事件时，它不会考虑订阅者是否接收到，而且订阅者接收到的顺序与其订阅顺序无关。这种方式主要适用于那些对接收顺序没有严格要求的情况。 有序公共事件：CES在转发公共事件时，会根据订阅者设置的优先级等级，优先将公共事件发送给优先级较高的订阅者。只有当优先级较高的订阅者成功接收到该公共事件后，CES才会将事件发送给优先级较低的订阅者。如果有多个订阅者具有相同的优先级，则他们会随机接收到公共事件。这种方式适用于那些需要按照一定顺序处理事件的场景。 粘性公共事件：粘性公共事件的特殊性在于，订阅者在订阅之前就能收到已经发送的公共事件。普通的公共事件只能在订阅后发送才能收到，而粘性公共事件则可以先发送后订阅。但是，发送粘性事件必须是系统应用或服务，并且需要申请ohos.permission.COMMONEVENT_STICKY权限。 每个应用都可以按需订阅公共事件。一旦订阅成功，当相关的公共事件发布时，系统会将其发送给对应的应用。这些公共事件可能来自系统、其他应用或应用自身。这为应用程序间的交互和协作提供了灵活和高效的方式。 <img src="https://cdn.nlark.com/yuque/0/2023/png/12928539/1702395701479-c97388cd-7858-420a-bd43-6255cdf78daa.png#averageHue=%23f7f6f3&amp;clientId=ub3c45dfd-47f2-4&amp;from=paste&amp;height=625&amp;id=ub0ce370e&amp;originHeight=1250&amp;originWidth=1590&amp;originalType=binary&amp;ratio=2&amp;rotation=0&amp;showTitle=false&amp;size=981940&amp;status=done&amp;style=none&amp;taskId=u5fc69a12-aa87-4cb2-a382-912154e05c7&amp;title=&amp;width=795" alt="image.png"></p><h2 id="二、动态订阅公共事件" tabindex="-1"><a class="header-anchor" href="#二、动态订阅公共事件"><span>二、动态订阅公共事件</span></a></h2><h3 id="概念" tabindex="-1"><a class="header-anchor" href="#概念"><span>概念</span></a></h3><p>动态订阅是HarmonyOS中的一个功能，允许应用在运行时根据需要订阅公共事件。当订阅的事件被发布时，应用会收到该事件及其参数。例如，应用可以在运行时订阅电量过低事件，一旦系统检测到电量过低并发布相关事件，订阅了该事件的应用会收到通知，然后可以采取措施如关闭非必要任务来降低功耗。但需要注意的是，订阅某些系统公共事件需要先申请相应的权限。这个功能增加了应用对外部事件的实时响应和处理能力，提高了应用的适应性和用户体验</p><h3 id="使用" tabindex="-1"><a class="header-anchor" href="#使用"><span>使用</span></a></h3><p>创建CommonEventSubscriber类</p><div class="language-typescript line-numbers-mode" data-highlighter="prismjs" data-ext="ts" data-title="ts"><pre class="language-typescript"><code><span class="line"><span class="token keyword">import</span> commonEvent <span class="token keyword">from</span> <span class="token string">&#39;@ohos.commonEventManager&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> commonEventManager <span class="token keyword">from</span> <span class="token string">&#39;@ohos.commonEventManager&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token comment">// import Base from &#39;@ohos.base&#39;;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">CommonEventSubscriber</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token comment">// 用于保存创建成功的订阅者对象，后续使用其完成订阅及退订的动作</span></span>
<span class="line">  <span class="token keyword">private</span> subscriber  <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token comment">// 订阅者信息</span></span>
<span class="line">  <span class="token keyword">private</span> subscribeInfo <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token keyword">as</span> <span class="token builtin">any</span></span>
<span class="line"></span>
<span class="line">  <span class="token doc-comment comment">/**</span>
<span class="line">   *</span>
<span class="line">   * <span class="token keyword">@param</span> <span class="token parameter">events</span> 要订阅的事件</span>
<span class="line">   * <span class="token keyword">@param</span> <span class="token parameter">cb</span> 订阅成功的回调</span>
<span class="line">   */</span></span>
<span class="line">  <span class="token function">constructor</span><span class="token punctuation">(</span>events<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> cb<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">this</span><span class="token punctuation">.</span>subscribeInfo <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">      events<span class="token punctuation">,</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">createSubscriber</span><span class="token punctuation">(</span>cb<span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">  <span class="token comment">// 创建订阅者</span></span>
<span class="line">  <span class="token keyword">public</span> <span class="token function">createSubscriber</span><span class="token punctuation">(</span>cb<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    commonEventManager<span class="token punctuation">.</span><span class="token function">createSubscriber</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>subscribeInfo<span class="token punctuation">,</span> <span class="token punctuation">(</span>err<span class="token punctuation">,</span> data<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">订阅失败,</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>err<span class="token punctuation">.</span>message<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">return</span><span class="token punctuation">;</span></span>
<span class="line">      <span class="token punctuation">}</span></span>
<span class="line">      <span class="token keyword">this</span><span class="token punctuation">.</span>subscriber <span class="token operator">=</span> data<span class="token punctuation">;</span></span>
<span class="line">      <span class="token comment">// 订阅公共事件回调</span></span>
<span class="line">      <span class="token function">cb</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">  <span class="token comment">// 订阅公共事件</span></span>
<span class="line">  <span class="token keyword">public</span> <span class="token function">subscribeToEvent</span><span class="token punctuation">(</span>callback<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>subscriber <span class="token operator">!==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">      commonEventManager<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>subscriber<span class="token punctuation">,</span> callback<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&#39;需要先创建一个订阅&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">  <span class="token comment">// 发布公共事件</span></span>
<span class="line">  <span class="token keyword">public</span> <span class="token function">publishEvent</span><span class="token punctuation">(</span>eventName<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> options<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">,</span> <span class="token function-variable function">callback</span><span class="token operator">:</span> <span class="token punctuation">(</span>err<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">void</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    commonEvent<span class="token punctuation">.</span><span class="token function">publish</span><span class="token punctuation">(</span>eventName<span class="token punctuation">,</span> options<span class="token punctuation">,</span> callback<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>某个订阅息屏事件</p><div class="language-typescript line-numbers-mode" data-highlighter="prismjs" data-ext="ts" data-title="ts"><pre class="language-typescript"><code><span class="line"><span class="token keyword">import</span> common <span class="token keyword">from</span> <span class="token string">&#39;@ohos.app.ability.common&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> router <span class="token keyword">from</span> <span class="token string">&#39;@ohos.router&#39;</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> CommonEventSubscriber <span class="token keyword">from</span> <span class="token string">&#39;./CommonEventManager&#39;</span></span>
<span class="line"></span>
<span class="line"><span class="token decorator"><span class="token at operator">@</span><span class="token function">Entry</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token decorator"><span class="token at operator">@</span><span class="token function">Component</span></span></span>
<span class="line">struct LearnStorage <span class="token punctuation">{</span></span>
<span class="line">  commonEventSubscriber<span class="token operator">:</span> CommonEventSubscriber</span>
<span class="line"></span>
<span class="line">  <span class="token function">onPageShow</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;每次显示触发&quot;</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">  <span class="token function">onPageHide</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;每次隐藏触发&#39;</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">  <span class="token function">onBackPress</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;返回触发&quot;</span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">  <span class="token function">aboutToAppear</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token doc-comment comment">/**</span>
<span class="line">     * 公共事件文档</span>
<span class="line">     * https://developer.harmonyos.com/cn/docs/documentation/doc-references-V3/commonevent-definitions-0000001544703941-V3#ZH-CN_TOPIC_0000001573929025__common_event_boot_completed</span>
<span class="line">     *</span>
<span class="line">     * 订阅息屏事件</span>
<span class="line">     */</span></span>
<span class="line">    <span class="token keyword">this</span><span class="token punctuation">.</span>commonEventSubscriber <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CommonEventSubscriber</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">&#39;usual.event.SCREEN_OFF&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token keyword">this</span><span class="token punctuation">.</span>commonEventSubscriber<span class="token punctuation">.</span><span class="token function">subscribeToEvent</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;触发息屏事件&quot;</span><span class="token punctuation">)</span></span>
<span class="line">      <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">  <span class="token function">aboutToDisappear</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;卸载触发&quot;</span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">  <span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token function">Row</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token function">Column</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token function">Button</span><span class="token punctuation">(</span><span class="token string">&#39;跳转到其他页面&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">onClick</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">          <span class="token comment">// 跳转到的时候会触发隐藏的生命周期</span></span>
<span class="line">          router<span class="token punctuation">.</span><span class="token function">pushUrl</span><span class="token punctuation">(</span><span class="token punctuation">{</span> url<span class="token operator">:</span> <span class="token string">&#39;pages/LearnRouter1&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token function">Button</span><span class="token punctuation">(</span><span class="token string">&#39;替换当前页面&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">onClick</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">          <span class="token comment">// 会触发卸载生命周期</span></span>
<span class="line">          router<span class="token punctuation">.</span><span class="token function">replaceUrl</span><span class="token punctuation">(</span><span class="token punctuation">{</span> url<span class="token operator">:</span> <span class="token string">&#39;pages/LearnRouter1&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">      <span class="token punctuation">}</span></span>
<span class="line">      <span class="token punctuation">.</span><span class="token function">width</span><span class="token punctuation">(</span><span class="token string">&#39;100%&#39;</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">.</span><span class="token function">height</span><span class="token punctuation">(</span><span class="token string">&#39;100%&#39;</span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,14),c=[e];function l(i,o){return a(),s("div",null,c)}const r=n(t,[["render",l],["__file","21-第二十一节——进程模型.html.vue"]]),k=JSON.parse('{"path":"/Beginner/21-%E7%AC%AC%E4%BA%8C%E5%8D%81%E4%B8%80%E8%8A%82%E2%80%94%E2%80%94%E8%BF%9B%E7%A8%8B%E6%A8%A1%E5%9E%8B.html","title":"","lang":"en-US","frontmatter":{},"headers":[{"level":2,"title":"一、概念","slug":"一、概念","link":"#一、概念","children":[]},{"level":2,"title":"二、动态订阅公共事件","slug":"二、动态订阅公共事件","link":"#二、动态订阅公共事件","children":[{"level":3,"title":"概念","slug":"概念","link":"#概念","children":[]},{"level":3,"title":"使用","slug":"使用","link":"#使用","children":[]}]}],"git":{"updatedTime":1719385700000,"contributors":[{"name":"etsuyou","email":"etsuyou.shuu@gmail.com","commits":1}]},"filePathRelative":"Beginner/21-第二十一节——进程模型.md"}');export{r as comp,k as data};
